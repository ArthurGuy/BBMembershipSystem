language: php
php:
  - 5.5
before_script:
  - travis_retry composer self-update
  - travis_retry composer install --prefer-source --no-interaction
  - mysql -e 'create database bbms_acceptance_testing;'
  - travis_retry npm install
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
script:
  - vendor/bin/codecept run  --coverage-xml
  - phpunit
  - npm test
after_script:
  - wget https://scrutinizer-ci.com/ocular.phar
  - php ocular.phar code-coverage:upload --format=php-clover app/tests/codeception/_output/coverage.xml
after_success:
  - curl https://api.rollbar.com/api/1/deploy/ --silent -F access_token=$ROLLBAR_API_KEY -F environment=production -F revision=$TRAVIS_COMMIT
notifications:
  email: false
  webhooks:
    urls:
     secure: kBzy6wGjnnbBgFEZaThifhjAvIPZ2X/DxfmQIti7k9uzfe0rhXV0KcCWwSwjJY9oxXgOIib1COd3/N470pY3uG3ujeUMPa1D+bbgoafOgALmSZwxKTl1ctttYr8+QD5LXOG3V9BALvUFfJALXexksvkcr/W+6ZAdqrrp/T8VMuo=
    on_success: always
    on_failure: never
  slack:
    secure: h4TcrEDPz8p92zFEXVu9IjmjfQhRnrbWas9sOE95pinxhOTe5DQ77fFetifDXeExCMmCKgVmJcQtJMmvx3oEUfTTyIxfdUGw+/uTk/X/wY2204IIL/WVxuBVGSKh4dt6BENLm8dZKDIeFsQxhUHdsH8gTBNlKJv+3Tht9vsDoK8=
env:
  global:
    - secure: LDABli5OS2hrPHtBHDcKPFPeRwxFNH4eybgoe6SwB8PzyNA2GA2V1J14J3nat179PHP+SRTsoJQ7/juiHgLJjl0wc8NZDBqzPkJQYoaYrfCbnci7+0Qe/EJqypMUJlOmdSAzMGgib7lppy3u0hzZYfQnyXl2QIeJtwKXS40R9cU=
    - secure: AzJuY4BoN79zN40OAZw0kRFci9p4zWLGE2AbiGjmviYP+8YV/Ik25hwrbWjmL/zRiV2KnA1mJpMlcXiztL5wjKhw2061ZLGaaeTGb4xWL5yPmkKRyDBjJsvG8YK86bf3KIs8wbAqR1Zxhzro5he4HB99whMlN2ZEEFPtJxcu1/w=
    - secure: zkev7qQ7naYAtt2oPOgUOpO2iRdiAzs6yJiudR6Qy2Xy1m6Pv9OF7d7gqND4w+x8nV1HiDsiCzP1iFl3Z4CuFp8FL3L4d7rKShOUvQ7SgUfMNQO2b8OZ0FZlzrEBroGc5QR4AJMVTl3jxg9BewNU/3nJ4Ar6RDVhrqNUKyqg4XU=
    - secure: Bj8Qp+1Qx/PIvMsWCaLBT2V1EVwrYBifXphTGfHzd/ssY98KOVT6Eg7CvgAQCRuDnGOTMKssHIceSUjGd5KhSvHI9AD8If1e7vHn9aLmveX3s9l5/pWbyYjY+x3MKVIfAwoEfSAeczFx7k1/ukniErR+X03GjZJDNWI3+gUKMpY=