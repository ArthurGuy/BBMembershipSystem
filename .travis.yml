language: php
php:
  - 5.5
before_script:
  - travis_retry composer self-update
  - travis_retry composer install --prefer-source --no-interaction
  - mysql -e 'create database bbms_acceptance_testing;'
script:
  - vendor/bin/codecept run  --coverage-xml
  - phpunit
after_script:
  - wget https://scrutinizer-ci.com/ocular.phar
  - php ocular.phar code-coverage:upload --format=php-clover app/tests/codeception/_output/coverage.xml
after_success:
  - curl https://api.rollbar.com/api/1/deploy/ --silent -F access_token=$ROLLBAR_API_KEY -F environment=production -F revision=$TRAVIS_COMMIT
notifications:
  email: false
  webhooks:
    urls:
     secure: kBzy6wGjnnbBgFEZaThifhjAvIPZ2X/DxfmQIti7k9uzfe0rhXV0KcCWwSwjJY9oxXgOIib1COd3/N470pY3uG3ujeUMPa1D+bbgoafOgALmSZwxKTl1ctttYr8+QD5LXOG3V9BALvUFfJALXexksvkcr/W+6ZAdqrrp/T8VMuo=
    on_success: always
    on_failure: never
  slack:
    secure: h4TcrEDPz8p92zFEXVu9IjmjfQhRnrbWas9sOE95pinxhOTe5DQ77fFetifDXeExCMmCKgVmJcQtJMmvx3oEUfTTyIxfdUGw+/uTk/X/wY2204IIL/WVxuBVGSKh4dt6BENLm8dZKDIeFsQxhUHdsH8gTBNlKJv+3Tht9vsDoK8=
env:
  global:
    - secure: LDABli5OS2hrPHtBHDcKPFPeRwxFNH4eybgoe6SwB8PzyNA2GA2V1J14J3nat179PHP+SRTsoJQ7/juiHgLJjl0wc8NZDBqzPkJQYoaYrfCbnci7+0Qe/EJqypMUJlOmdSAzMGgib7lppy3u0hzZYfQnyXl2QIeJtwKXS40R9cU=
    - DB_DATABASE=bbms_acceptance_testing
    - DB_USERNAME=root
    - DB_PASSWORD=
    - DB_HOST=localhost
    - APP_ENV=testing
    - CACHE_DRIVER=array
    - SESSION_DRIVER=array
    - QUEUE_DRIVER=sync